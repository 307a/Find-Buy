<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Items - Search & Browse</title>
    <link rel="stylesheet" href="../bootstrap-5.3.3-dist/bootstrap-5.3.3-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../fontawesome-free-6.7.2-web/css/all.min.css">
    <style>
        body { background: #fff; color: #222; }
        .section-title { font-size: 2rem; font-weight: bold; margin-bottom: 1.5rem; color: #f66435; }
        .carousel-item { padding: 10px 0; }
        .item-card { min-width: 200px; max-width: 220px; margin: 0 auto; }
        .carousel-inner { display: flex; }
        .carousel-item { flex: 0 0 100%; }
        .category-section { padding-top: 60px; }
        .scrollspy-nav { position: sticky; top: 0; z-index: 100; background: #fff; }
    </style>
</head>
<body data-bs-spy="scroll" data-bs-target="#categoryNav" data-bs-offset="80" tabindex="0">
    <!-- Location Modal -->
    <div class="modal fade" id="locationModal" tabindex="-1" aria-labelledby="locationModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="locationModalLabel">Choose Your Location</h5>
          </div>
          <div class="modal-body">
            <select class="form-select" id="locationSelect">
              <option value="">Select a location</option>
              <option value="Delhi">Delhi</option>
              <option value="Mumbai">Mumbai</option>
              <option value="Bangalore">Bangalore</option>
              <option value="Chennai">Chennai</option>
            </select>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" id="locationConfirm">Confirm</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Navigation & Search -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light scrollspy-nav" id="categoryNav">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Shop Items</a>
        <form class="d-flex ms-auto" role="search" id="searchForm">
          <input class="form-control me-2" type="search" placeholder="Search for items..." aria-label="Search" id="searchInput">
          <button class="btn btn-outline-success" type="submit" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Search by name">Search</button>
        </form>
      </div>
      <div class="container-fluid mt-2">
        <ul class="nav nav-pills justify-content-center gap-2" id="categoryLinks">
          <!-- Category links will be injected here -->
        </ul>
      </div>
    </nav>
    <main class="container py-4">
      <!-- Category sections will be injected here -->
      <div id="itemsContainer"></div>
    </main>
    <script src="../bootstrap-5.3.3-dist/bootstrap-5.3.3-dist/js/bootstrap.bundle.min.js"></script>
    <script>
    // Sample data
    const items = [
      { name: 'Notebook', category: 'Stationary', image: './Images/notebook.jpg', price: 50, location: 'Delhi', shop: 'ABC Stationers', contact: '9876543210' },
      { name: 'Pen', category: 'Stationary', image: './Images/pen.jpg', price: 10, location: 'Delhi', shop: 'XYZ Books', contact: '9123456780' },
      { name: 'Eraser', category: 'Stationary', image: './Images/eraser.jpg', price: 5, location: 'Delhi', shop: 'ABC Stationers', contact: '9876543210' },
      { name: 'Laptop', category: 'Electronics', image: './Images/laptop.jpg', price: 40000, location: 'Mumbai', shop: 'Tech World', contact: '9988776655' },
      { name: 'Mouse', category: 'Electronics', image: './Images/mouse.jpg', price: 500, location: 'Mumbai', shop: 'Tech World', contact: '9988776655' },
      { name: 'Water Bottle', category: 'Home', image: './Images/bottle.jpg', price: 150, location: 'Bangalore', shop: 'Home Needs', contact: '8877665544' },
      { name: 'Table Lamp', category: 'Home', image: './Images/lamp.jpg', price: 700, location: 'Bangalore', shop: 'Home Needs', contact: '8877665544' },
      { name: 'Calculator', category: 'Stationary', image: './Images/calculator.jpg', price: 250, location: 'Chennai', shop: 'Math Store', contact: '7766554433' },
      { name: 'Marker', category: 'Stationary', image: './Images/marker.jpg', price: 20, location: 'Chennai', shop: 'Math Store', contact: '7766554433' },
      { name: 'Charger', category: 'Electronics', image: './Images/charger.jpg', price: 800, location: 'Delhi', shop: 'ElectroHub', contact: '9000112233' },
      // Add more items as needed
    ];
    let userLocation = '';
    let filteredItems = [];
    // Show location modal on load
    window.addEventListener('DOMContentLoaded', () => {
      const locationModal = new bootstrap.Modal(document.getElementById('locationModal'));
      locationModal.show();
      document.getElementById('locationConfirm').onclick = function() {
        const loc = document.getElementById('locationSelect').value;
        if (loc) {
          userLocation = loc;
          locationModal.hide();
          filterAndRender();
        }
      };
      // Enable tooltips
      var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
      tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
      });
    });
    // Filter and render items
    function filterAndRender(searchTerm = '', selectedCategory = '') {
      filteredItems = items.filter(item => item.location === userLocation &&
        (!searchTerm || item.name.toLowerCase().includes(searchTerm.toLowerCase())) &&
        (!selectedCategory || item.category === selectedCategory)
      );
      renderCategories();
    }
    // Get unique categories for nav
    function getCategories() {
      return [...new Set(filteredItems.map(item => item.category))];
    }
    // Render category nav links and sections
    function renderCategories() {
      const categories = getCategories();
      const nav = document.getElementById('categoryLinks');
      nav.innerHTML = categories.map((cat, idx) =>
        `<li class="nav-item"><a class="nav-link${idx===0?' active':''}" href="#cat-${cat}" data-bs-toggle="tooltip" title="Go to ${cat}">${cat}</a></li>`
      ).join('');
      // Category sections
      const container = document.getElementById('itemsContainer');
      container.innerHTML = categories.map(cat => renderCategorySection(cat)).join('');
      // Activate scrollspy
      bootstrap.ScrollSpy.getOrCreateInstance(document.body, { target: '#categoryNav', offset: 80 });
      // Enable tooltips again (for dynamic elements)
      var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
      tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
      });
    }
    // Render a section with carousel for a category
    function renderCategorySection(category) {
      const catItems = filteredItems.filter(item => item.category === category);
      const slides = [];
      for (let i = 0; i < catItems.length; i += 5) {
        slides.push(catItems.slice(i, i + 5));
      }
      const carouselId = `carousel-${category}`;
      return `
      <section class="category-section" id="cat-${category}">
        <h2 class="section-title">${category}</h2>
        <div id="${carouselId}" class="carousel slide" data-bs-ride="carousel">
          <div class="carousel-inner">
            ${slides.map((slide, idx) => `
              <div class="carousel-item${idx===0?' active':''}">
                <div class="row justify-content-center">
                  ${slide.map(item => renderItemCard(item)).join('')}
                </div>
              </div>
            `).join('')}
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#${carouselId}" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#${carouselId}" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>
      </section>
      `;
    }
    // Render a single item card
    function renderItemCard(item) {
      return `
      <div class="col-md-2 item-card mb-3">
        <div class="card h-100 shadow-sm">
          <img src="${item.image}" class="card-img-top" alt="${item.name}" style="height:120px;object-fit:cover;">
          <div class="card-body">
            <h5 class="card-title">${item.name}</h5>
            <p class="card-text mb-1"><span class="fw-bold">â‚¹${item.price}</span></p>
            <p class="card-text mb-1"><span data-bs-toggle="tooltip" title="Shop Location">${item.location}</span></p>
            <p class="card-text mb-1"><span data-bs-toggle="tooltip" title="Shop Name">${item.shop}</span></p>
            <p class="card-text"><span data-bs-toggle="tooltip" title="Contact Shop">${item.contact}</span></p>
          </div>
        </div>
      </div>
      `;
    }
    // Handle search
    document.getElementById('searchForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const searchTerm = document.getElementById('searchInput').value.trim();
      filterAndRender(searchTerm);
    });
    // Handle category click
    document.getElementById('categoryLinks').addEventListener('click', function(e) {
      if (e.target.tagName === 'A') {
        const cat = e.target.textContent;
        filterAndRender('', cat);
      }
    });
    </script>
</body>
</html>
